<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="../favicon.png" />
		<meta name="viewport" content="width=device-width" />
		<link href="/prism.css" rel="stylesheet" />

		<meta http-equiv="content-security-policy" content="">
		<link href="../_app/immutable/assets/_layout.0841d261.css" rel="stylesheet">
		<link rel="modulepreload" href="../_app/immutable/entry/start.ff6a61e9.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/index.bc8fed38.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/singletons.4c35e8d6.js">
		<link rel="modulepreload" href="../_app/immutable/entry/app.fcfc16ec.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/preload-helper.41c905a7.js">
		<link rel="modulepreload" href="../_app/immutable/entry/_layout.svelte.d2ec22b3.js">
		<link rel="modulepreload" href="../_app/immutable/entry/_layout.ts.34363208.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/_layout.c7a3ca83.js">
		<link rel="modulepreload" href="../_app/immutable/entry/blog-_slug_-page.svelte.acdc8f4a.js">
		<link rel="modulepreload" href="../_app/immutable/entry/blog-_slug_-page.ts.91fdb10b.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/_page.02901516.js"><title>How to write a command line application in rust</title><!-- HEAD_svelte-xvt9is_START --><!-- HEAD_svelte-xvt9is_END -->
	</head>
	<body data-sveltekit-preload-data="hover">
		<div style="display: contents">


<main style="max-width: 52rem;margin:auto"><h1 class="logo logo-small svelte-1tkco1r"><a class="header-link svelte-1tkco1r" href="/">unstack.in </a></h1>

		<div>
<div class="post"><h2 style="margin-bottom: 0">How to write a command line application in rust</h2>
<div class="date">2023-07-31</div>
	<p>Writing a command line application in rust in not that hard. Mainly because of the library ecosystem for writing CLI apps in rust.</p>
<p>Before we get started, make sure you have <code>rustc</code> and <code>cargo</code> installed on your machine. If you don’t know how to do that, check this <a href="/blog/2023-07-31-rust-quick-setup-macos">link</a>.</p>
<hr>
<p>Let’s build a small CLI app which takes 2 numbers as inputs and prints the sum of the numbers. We will not use any library for this one.</p>
<p>Let’s create our rust app first -</p>
<pre class="language-bash"><!-- HTML_TAG_START --><code class="language-bash"><span class="token function">cargo</span> new add-machine
<span class="token builtin class-name">cd</span> add-machine
<span class="token function">cargo</span> run</code><!-- HTML_TAG_END --></pre>
<p>When we build a <code>rust</code> app, it’s already a CLI app. The app we created above just prints “Hello, world!“. But it’s a CLI app nevertheless, i.e. it’s an executable which can be run in a shell.</p>
<p>We want to finally call our app like this -</p>
<pre class="language-bash"><!-- HTML_TAG_START --><code class="language-bash">add-machine <span class="token number">2</span> <span class="token number">3</span>
// prints <span class="token number">5</span></code><!-- HTML_TAG_END --></pre>
<p>During development we will run the same app with <code>cargo</code></p>
<pre class="language-bash"><!-- HTML_TAG_START --><code class="language-bash"><span class="token function">cargo</span> run <span class="token number">2</span> <span class="token number">3</span>
// prints <span class="token number">5</span></code><!-- HTML_TAG_END --></pre>
<p>The first step is to get the input from the terminal from the user inside our program. <code>rust</code> standard library has a <code>env</code> module which has an <code>args</code> function which can provide us the input after the command as a list of strings.</p>
<pre class="language-rust"><!-- HTML_TAG_START --><code class="language-rust"><span class="token comment">// file src/main.rs</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>env<span class="token punctuation">;</span> <span class="token comment">// bring the env module in scope</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">let</span> args<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span></span>args<span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;:?&#125;"</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code><!-- HTML_TAG_END --></pre>
<p>This program when run should print a vector whose first value is the path to the program itself and the rest of the values are all the arguments we pass to the command (separated by space).</p>
<p>Something like this</p>
<pre class="language-bash"><!-- HTML_TAG_START --><code class="language-bash"><span class="token function">cargo</span> run <span class="token number">2</span> <span class="token number">3</span>
<span class="token punctuation">[</span><span class="token string">"target/debug/rust-cli"</span>, <span class="token string">"2"</span>, <span class="token string">"3"</span><span class="token punctuation">]</span></code><!-- HTML_TAG_END --></pre>
<p>Now that we have the input from the user, we need to first transform them from strings to numbers.</p>
<pre class="language-rust"><!-- HTML_TAG_START --><code class="language-rust"><span class="token comment">// file src/main.rs</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>env<span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> args<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token namespace">env<span class="token punctuation">::</span></span><span class="token function">args</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 1. Get the arguments which start from 1st index</span>
    <span class="token comment">// 2. Map over the arguments and parse the strings into numbers</span>
    <span class="token comment">// 3. TODO: User's might input non-numbers. Or less than 2 arguments. Hanlde those</span>
    <span class="token comment">// error cases later.</span>
    <span class="token keyword">let</span> nums<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token operator">></span> <span class="token operator">=</span> args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">..</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>x<span class="token closure-punctuation punctuation">|</span></span> x<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;:?&#125; &#123;:?&#125;"</span><span class="token punctuation">,</span>  args<span class="token punctuation">,</span> nums<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code><!-- HTML_TAG_END --></pre>
<p>We have gotten hold of the arguments. Let’s add them up and print it out.</p>
<pre class="language-rust"><!-- HTML_TAG_START --><code class="language-rust"><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"The sum of &#123;&#125; and &#123;&#125; is &#123;&#125;"</span><span class="token punctuation">,</span>  nums<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> nums<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> nums<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> nums<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><!-- HTML_TAG_END --></pre>
<p>Our program should now be able to add 2 numbers -</p>
<pre class="language-bash"><!-- HTML_TAG_START --><code class="language-bash"><span class="token function">cargo</span> run <span class="token number">2</span> <span class="token number">3</span>
// should print <span class="token string">"The sum of 2 and 3 is 5"</span></code><!-- HTML_TAG_END --></pre>
<h3 id="using-a-library-to-build-our-cli-application---clap"><a aria-hidden="true" tabindex="-1" href="#using-a-library-to-build-our-cli-application---clap"><span class="icon icon-link"></span></a>Using a library to build our CLI application - <code>clap</code></h3>
<p>Let’s build the same application using a library called <a href="https://docs.rs/clap/latest/clap/" rel="nofollow"><code>clap</code></a>, which helps with a lot more than just parsing the arguments.</p>
<p>We will use <code>cargo-edit</code> to add the library instead of directly editing <code>Cargo.toml</code> file.</p>
<pre class="language-bash"><!-- HTML_TAG_START --><code class="language-bash"><span class="token function">cargo</span> <span class="token function">add</span> clap <span class="token parameter variable">--feature</span> derive</code><!-- HTML_TAG_END --></pre>
<p>Our <code>Cargo.toml</code> should now have an entry for the <code>clap</code> library and it’s ready to use in our program.</p>
<p>Now we will use <code>clap</code> to parse the arguments we pass to our app/program -</p>
<pre class="language-rust"><!-- HTML_TAG_START --><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">clap<span class="token punctuation">::</span></span><span class="token class-name">Parser</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[derive(Debug, Parser)]</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">Cli</span> <span class="token punctuation">&#123;</span>
    num1<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span>
    num2<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> args <span class="token operator">=</span> <span class="token class-name">Cli</span><span class="token punctuation">::</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;:?&#125;"</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"The sum of &#123;&#125; and &#123;&#125; is &#123;&#125;"</span><span class="token punctuation">,</span> args<span class="token punctuation">.</span>num1<span class="token punctuation">,</span> args<span class="token punctuation">.</span>num2<span class="token punctuation">,</span> args<span class="token punctuation">.</span>num1 <span class="token operator">+</span> args<span class="token punctuation">.</span>num2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code><!-- HTML_TAG_END --></pre>
<p>In the above program, we create a struct where we define 2 properties where we will hold our numbers to be added. We annotate the struct with <code>#[derive(Parser)]</code> attribute. That piece of code will enhance our <code>Cli</code> struct with the ability to read our command line arguments and parse them as per our type definitions for <code>num1</code> and <code>num2</code>. This seems like magic and probably is.</p>
<p>This program should now work exactly as our program without <code>clap</code>.</p>
<pre class="language-bash"><!-- HTML_TAG_START --><code class="language-bash"><span class="token function">cargo</span> run <span class="token number">2</span> <span class="token number">3</span>
// should print <span class="token string">"The sum of 2 and 3 is 5"</span></code><!-- HTML_TAG_END --></pre>
<p>The great thing about using <code>clap</code> is that we now get free help instructions for our program.</p>
<pre class="language-bash"><!-- HTML_TAG_START --><code class="language-bash">% <span class="token function">cargo</span> run -- <span class="token parameter variable">--help</span>
    Finished dev <span class="token punctuation">[</span>unoptimized + debuginfo<span class="token punctuation">]</span> target<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token number">0</span>.07s
     Running <span class="token variable"><span class="token variable">&#96;</span>target/debug/rust-cli <span class="token parameter variable">--help</span><span class="token variable">&#96;</span></span>
Usage: rust-cli <span class="token operator">&lt;</span>NUM<span class="token operator"><span class="token file-descriptor important">1</span>></span> <span class="token operator">&lt;</span>NUM<span class="token operator"><span class="token file-descriptor important">2</span>></span>

Arguments:
  <span class="token operator">&lt;</span>NUM<span class="token operator"><span class="token file-descriptor important">1</span>></span>
  <span class="token operator">&lt;</span>NUM<span class="token operator"><span class="token file-descriptor important">2</span>></span>

Options:
  -h, <span class="token parameter variable">--help</span>  Print <span class="token builtin class-name">help</span></code><!-- HTML_TAG_END --></pre>
<p>Not just that, we also get some free error handling. What if the user who invokes our command provides something other than a number as input? The <code>clap</code> parser will catch it and let the user know -</p>
<pre class="language-bash"><!-- HTML_TAG_START --><code class="language-bash">% <span class="token function">cargo</span> run <span class="token number">2</span> three
    Finished dev <span class="token punctuation">[</span>unoptimized + debuginfo<span class="token punctuation">]</span> target<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token number">0</span>.02s
     Running <span class="token variable"><span class="token variable">&#96;</span>target/debug/rust-cli <span class="token number">2</span> three<span class="token variable">&#96;</span></span>
error: invalid value <span class="token string">'three'</span> <span class="token keyword">for</span> <span class="token string">'&lt;NUM2>'</span><span class="token builtin class-name">:</span> invalid digit found <span class="token keyword">in</span> string

For <span class="token function">more</span> information, try <span class="token string">'--help'</span><span class="token builtin class-name">.</span></code><!-- HTML_TAG_END --></pre>
<p>Of course <code>clap</code> provides much more than this.</p>
	<br>
	<a href="/">Browse more posts</a>
	<hr>
	<h3>About me</h3>
	<div style="display: flex; margin-bottom: 3.5rem; flex-direction: column;"><div style="display: flex"><img src="/profile-pic.jpg" alt="Mukesh Soni" style="margin-right: 1rem; margin-bottom: 0; width: 56px; height: 56px">
		<div><p style="margin-top: 0;">This is the personal blog of <strong>Mukesh Soni</strong>. I am a frontend engineer who&#39;s
				exhausted trying to keep up with the new technologies in the frontend world. I am good at
				JavaScript, HTML, CSS, React (ReactJS) and nodejs. I have been doing this stuff since 2011.
			</p>
			<p style="margin-top: 0">This blog was written in <a href="https://svelte.dev">svelte</a>, using
				<a href="https://kit.svelte.dev/">svelte-kit</a>, even though i write reactjs in my day job.
			</p></div></div>
	<a style="text-decoration: none; box-shadow: none;" href="https://twitter.com/mukeshsoni">Follow me on Twitter
	</a>
	<a style="text-decoration: none; box-shadow: none;" href="https://github.com/mukeshsoni">Look at my open source work on github
	</a></div></div></div></main>


			
			<script>
				{
					__sveltekit_1n4vdzs = {
						env: {},
						assets: new URL("..", location.href).pathname.replace(/^\/$/, ''),
						element: document.currentScript.parentElement
					};

					const data = [null,null];

					Promise.all([
						import("../_app/immutable/entry/start.ff6a61e9.js"),
						import("../_app/immutable/entry/app.fcfc16ec.js")
					]).then(([kit, app]) => {
						kit.start(app, __sveltekit_1n4vdzs.element, {
							node_ids: [0, 3],
							data,
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
	</body>
</html>
